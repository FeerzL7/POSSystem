<UserControl x:Class="POSSystem.Presentation.WPF.Views.VentaView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{StaticResource BackgroundColor}">

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>

        <!-- PANEL IZQUIERDO - ACCIONES -->
        <Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,5,0">
            <StackPanel>
                <!-- Título -->
                <TextBlock Text="PUNTO DE VENTA" Style="{StaticResource TitleStyle}"/>

                <!-- Folio -->
                <StackPanel Orientation="Horizontal" Margin="10">
                    <TextBlock Text="Folio:" 
                              FontWeight="Bold" 
                              FontSize="16" 
                              VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding FolioVenta}" 
                              FontSize="16" 
                              Margin="10,0"
                              Foreground="{StaticResource PrimaryColor}"/>
                </StackPanel>

                <Separator Margin="10"/>

                <!-- Nueva Venta -->
                <Button Content="NUEVA VENTA" 
                        Style="{StaticResource SuccessButtonStyle}"
                        Command="{Binding NuevaVentaCommand}"
                        Height="50"
                        FontSize="16"
                        Margin="10"/>

                <!-- Escanear Producto -->
                <Label Content="Código de Barras:" Style="{StaticResource BaseLabelStyle}"/>
                <TextBox Text="{Binding CodigoBarras, UpdateSourceTrigger=PropertyChanged}"
                         Style="{StaticResource BaseTextBoxStyle}"
                         FontSize="16"
                         Height="40"/>

                <Button Content="ESCANEAR PRODUCTO" 
                        Style="{StaticResource PrimaryButtonStyle}"
                        Command="{Binding EscanearProductoCommand}"
                        Height="45"
                        FontSize="14"
                        Margin="10"/>

                <Separator Margin="10,20"/>

                <!-- Totales -->
                <StackPanel Margin="10">
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="Subtotal:" Width="100" FontSize="14"/>
                        <TextBlock Text="{Binding Subtotal, StringFormat=C}" 
                                  FontSize="14" 
                                  FontWeight="Bold"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="IVA:" Width="100" FontSize="14"/>
                        <TextBlock Text="{Binding Impuestos, StringFormat=C}" 
                                  FontSize="14"/>
                    </StackPanel>

                    <Separator Margin="0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="TOTAL:" Width="100" FontSize="20" FontWeight="Bold"/>
                        <TextBlock Text="{Binding Total, StringFormat=C}" 
                                  FontSize="28" 
                                  FontWeight="Bold"
                                  Foreground="{StaticResource PrimaryColor}"/>
                    </StackPanel>
                </StackPanel>

                <Separator Margin="10,20"/>

                <!-- Botones de Pago -->
                <Button Content="PAGAR EFECTIVO" 
                        Style="{StaticResource SuccessButtonStyle}"
                        Command="{Binding PagarEfectivoCommand}"
                        Height="50"
                        FontSize="16"
                        Margin="10,5"/>

                <Button Content="PAGAR TARJETA" 
                        Style="{StaticResource PrimaryButtonStyle}"
                        Command="{Binding PagarTarjetaCommand}"
                        Height="50"
                        FontSize="16"
                        Margin="10,5"/>

                <Button Content="CANCELAR VENTA" 
                        Style="{StaticResource ErrorButtonStyle}"
                        Command="{Binding CancelarVentaCommand}"
                        Height="45"
                        FontSize="14"
                        Margin="10,20,10,5"/>

                <!-- Estado -->
                <Border Background="{StaticResource PrimaryColor}" 
                        CornerRadius="4" 
                        Padding="10" 
                        Margin="10,20,10,10">
                    <TextBlock Text="{Binding MensajeEstado}" 
                              Foreground="White" 
                              FontSize="12"
                              TextWrapping="Wrap"
                              TextAlignment="Center"/>
                </Border>
            </StackPanel>
        </Border>

        <!-- PANEL DERECHO - LISTA DE PRODUCTOS -->
        <Border Grid.Column="1" Style="{StaticResource CardStyle}" Margin="5,0,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Encabezado -->
                <TextBlock Grid.Row="0" 
                          Text="PRODUCTOS EN LA VENTA" 
                          Style="{StaticResource SubtitleStyle}"/>

                <!-- DataGrid de productos -->
                <DataGrid Grid.Row="1"
                         ItemsSource="{Binding ProductosVenta}"
                         Style="{StaticResource BaseDataGridStyle}"
                         Margin="10">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Código" 
                                          Binding="{Binding CodigoBarras}" 
                                          Width="120"/>
                        <DataGridTextColumn Header="Producto" 
                                          Binding="{Binding NombreProducto}" 
                                          Width="*"/>
                        <DataGridTextColumn Header="Cantidad" 
                                          Binding="{Binding Cantidad}" 
                                          Width="80">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Precio Unit." 
                                          Binding="{Binding PrecioUnitario, StringFormat=C}" 
                                          Width="100">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Right"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Total" 
                                          Binding="{Binding Total, StringFormat=C}" 
                                          Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Right"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="Foreground" Value="{StaticResource PrimaryColor}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTemplateColumn Header="Acciones" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="Quitar" 
                                           Style="{StaticResource ErrorButtonStyle}"
                                           Command="{Binding DataContext.QuitarProductoCommand, 
                                                   RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                           CommandParameter="{Binding}"
                                           Padding="10,5"
                                           FontSize="12"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>
    </Grid>
</UserControl>
